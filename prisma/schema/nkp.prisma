model PaymentAuthorization {
  id             Int           @id @default(autoincrement())
  date           DateTime      @default(now()) @db.Date
  number         String?       @db.VarChar(50) // generated by system
  Employee       User?         @relation(fields: [employeeId], references: [id], name: "PaymentAuthorization")
  employeeId     Int?
  Supplier       Supplier?     @relation(fields: [supplierId], references: [id])
  supplierId     Int?
  Requester      User          @relation(fields: [requesterId], references: [id], name: "PaymentAuthorizationRequest")
  requesterId    Int
  description    String        @db.Text
  expenseClaimId Int?          @unique
  status         PaymentStatus @default(DRAFT)
  paymentType    PaymentType   @default(EMPLOYEE)

  // bank related
  Bank        Bank     @relation(fields: [bankId], references: [id])
  bankId      Int
  bankAccount String   @db.VarChar(30)
  currency    Currency @default(IDR)
  bankRefNo   String?  @db.VarChar(30)

  // amount related
  grandTotal   Int  @db.Integer
  deduction    Int  @default(0) @db.Integer
  tax          Int  @default(0) @db.Integer
  downPayment  Int  @default(0) @db.Integer
  cashAdvance  Int  @default(0) @db.Integer
  netAmount    Int  @db.Integer
  finalPayment Int? @db.Integer

  // timestamp
  createdAt  DateTime  @default(now())
  updatedAt  DateTime? @updatedAt
  approvedAt DateTime?
  verifiedAt DateTime?
  paidAt     DateTime?

  PaymentAuthorizationItem       PaymentAuthorizationItem[]
  PaymentAuthorizationApproval   PaymentAuthorizationApproval[]
  Company                        Company                          @relation(fields: [companyId], references: [id])
  companyId                      Int
  PaymentAuthorizationAttachment PaymentAuthorizationAttachment[]

  Parent   PaymentAuthorization? @relation("Parent", fields: [parentId], references: [id])
  Child    PaymentAuthorization? @relation("Parent")
  parentId Int?                  @unique

  @@index([employeeId, requesterId, bankId, expenseClaimId, companyId])
  @@map("PaymentAuthorizations")
}

model PaymentAuthorizationItem {
  id                     Int                   @id @default(autoincrement())
  date                   DateTime              @db.Date
  description            String                @db.Text
  amount                 Int                   @db.Integer
  currency               Currency              @default(IDR)
  PaymentAuthorization   PaymentAuthorization? @relation(fields: [paymentAuthorizationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  paymentAuthorizationId Int

  @@index([paymentAuthorizationId])
  @@map("PaymentAuthorizationItems")
}

model PaymentAuthorizationApproval {
  id                     Int                  @id @default(autoincrement())
  User                   User                 @relation(fields: [userId], references: [id])
  userId                 Int
  approvalActionType     ApprovalActionType
  level                  Int                  @db.SmallInt
  PaymentAuthorization   PaymentAuthorization @relation(fields: [paymentAuthorizationId], references: [id])
  approvalStatus         ApprovalStatus? // kirim notifikasi per hari jika status null
  note                   String?              @db.VarChar(255)
  createdAt              DateTime             @default(now())
  updatedAt              DateTime?            @updatedAt
  paymentAuthorizationId Int

  @@unique([userId, paymentAuthorizationId])
  @@index([userId, paymentAuthorizationId])
  @@map("PaymentAuthorizationApprovals")
}

model PaymentAuthorizationAttachment {
  id                   Int                  @id @default(autoincrement())
  PaymentAuthorization PaymentAuthorization @relation(fields: [paymentAuthorizationId], references: [id])
  description          String?              @db.VarChar(255)

  fileName               String @db.VarChar(255)
  filePath               String @db.Text
  fileSize               Int    @db.Integer
  fileType               String @db.VarChar(30)
  paymentAuthorizationId Int

  @@index([paymentAuthorizationId])
  @@map("PaymentAuthorizationAttachments")
}
