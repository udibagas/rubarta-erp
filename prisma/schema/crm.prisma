model Customer {
  id            Int            @id @default(autoincrement())
  name          String
  address       String
  phone         String
  email         String
  Invoices      Invoice[]
  Contacts      Contact[]
  Leads         Lead[]
  Opportunities Opportunity[]
  Tasks         Task[]
  Interactions  Interaction[]
  Orders        Order[]
  CustomerNote  CustomerNote[]
  CustomerFile  CustomerFile[]
  Quotation     Quotation[]

  @@map("Customers")
}

model Contact {
  id         Int      @id @default(autoincrement())
  customerId Int
  name       String
  email      String?  @unique
  phone      String
  position   String?
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relationships
  Customer Customer @relation(fields: [customerId], references: [id])

  @@map("Contacts")
}

enum LeadStatus {
  New // Newly created lead
  Contacted // Initial contact made
  Qualified // Interested and a good fit
  Unqualified // Not interested or not a good fit
  Converted // Converted to Opportunity
}

enum LeadSource {
  Referral
  Advertisement
  SocialMedia
  Website
  Other
}

enum OpportunityStages {
  Prospecting // Initial stage of identifying potential customers
  Negotiation // Discussing terms and conditions
  Proposal_Sent // Proposal has been sent to the customer
  Closed_Won // Opportunity has been won
  Closed_Lost // Opportunity has been lost
}

enum QuotationStatus {
  Draft // Quotation is being prepared
  Sent // Quotation has been sent to the customer
  Accepted // Customer has accepted the quotation
  Rejected // Customer has rejected the quotation
  Expired // Quotation validity period has expired
}

model Lead {
  id Int @id @default(autoincrement())

  customerId Int
  companyId  Int
  userId     Int
  source     LeadSource
  status     LeadStatus @default(New)
  notes      String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  Customer Customer @relation(fields: [customerId], references: [id])
  Company  Company  @relation(fields: [companyId], references: [id])
  User     User     @relation(fields: [userId], references: [id])

  @@map("Leads")
}

model Opportunity {
  id                Int               @id @default(autoincrement())
  customerId        Int
  companyId         Int
  userId            Int
  name              String
  amount            Float
  stage             OpportunityStages
  expectedCloseDate DateTime
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  // Relationships
  Customer   Customer    @relation(fields: [customerId], references: [id])
  User       User        @relation(fields: [userId], references: [id])
  Company    Company     @relation(fields: [companyId], references: [id])
  Quotations Quotation[]

  @@map("Opportunities")
}

model Quotation {
  id          Int             @id @default(autoincrement())
  number      String          @unique
  title       String
  totalAmount Float
  vatAmount   Float           @default(0)
  grandTotal  Float
  status      QuotationStatus @default(Draft)
  currency    Currency        @default(IDR) // Currency code, e.g., IDR, USD
  validity    Int             @default(30) // Validity period in days
  validUntil  DateTime

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Foreign Keys
  customerId    Int
  userId        Int
  opportunityId Int?

  // Relationships
  Opportunity    Opportunity?    @relation(fields: [opportunityId], references: [id])
  Customer       Customer        @relation(fields: [customerId], references: [id])
  User           User            @relation(fields: [userId], references: [id])
  QuotationItems QuotationItem[]

  @@map("Quotations")
}

model QuotationItem {
  id          Int     @id @default(autoincrement())
  quotationId Int
  partNumber  String
  description String
  quantity    Int
  unitPrice   Float
  totalPrice  Float
  vat         Boolean @default(false) // Indicates if VAT is applicable

  // Relationships
  Quotation Quotation @relation(fields: [quotationId], references: [id])

  @@map("QuotationItems")
}

model Task {
  id          Int      @id @default(autoincrement())
  userId      Int
  customerId  Int
  title       String
  description String?
  dueDate     DateTime
  status      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relationships
  User     User     @relation(fields: [userId], references: [id])
  Customer Customer @relation(fields: [customerId], references: [id])

  @@map("Tasks")
}

model Interaction {
  id         Int      @id @default(autoincrement())
  customerId Int
  userId     Int
  type       String
  date       DateTime
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt @map("updatedAt")

  // Relationships
  Customer Customer @relation(fields: [customerId], references: [id])
  User     User     @relation(fields: [userId], references: [id])

  @@map("Interactions")
}

enum OrderStatus {
  Pending
  Processing
  Completed
  Cancelled
}

model Order {
  id          Int         @id @default(autoincrement())
  number      String      @unique
  date        DateTime
  customerId  Int
  totalAmount Float
  vatAmount   Float       @default(0)
  grandTotal  Float
  status      OrderStatus

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  Customer   Customer    @relation(fields: [customerId], references: [id])
  Invoice    Invoice?
  OrderItems OrderItem[]

  @@map("Orders")
}

model OrderItem {
  id          Int     @id @default(autoincrement())
  orderId     Int
  partNumber  String
  description String
  quantity    Int
  unitPrice   Float
  totalPrice  Float
  vat         Boolean @default(false) // Indicates if VAT is applicable

  // Relationships
  Order Order @relation(fields: [orderId], references: [id])

  @@map("OrderItems")
}

model CustomerNote {
  id         Int      @id @default(autoincrement())
  customerId Int
  userId     Int
  content    String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relationships
  Customer Customer @relation(fields: [customerId], references: [id])
  User     User     @relation(fields: [userId], references: [id])

  @@map("CustomerNotes")
}

model CustomerFile {
  id          Int     @id @default(autoincrement())
  customerId  Int
  description String?

  fileName String @db.VarChar(255)
  filePath String @db.Text
  fileSize Int    @db.Integer
  fileType String @db.VarChar(30)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  Customer Customer @relation(fields: [customerId], references: [id])

  @@map("CustomerFiles")
}

model Material {
  id            Int     @id @default(autoincrement())
  partNumber    String  @unique
  name          String
  description   String?
  unit          String // e.g., pcs, kg, liter
  purchasePrice Float?
  sellingPrice  Float?
  supplierId    Int?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  Supplier Supplier? @relation(fields: [supplierId], references: [id])

  @@map("Materials")
}
